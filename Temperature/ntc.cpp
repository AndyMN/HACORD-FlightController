#include <string>
#include "ntc.hpp"
#include <iterator>

float ntc::get_temperature(float adcvalue, float voltage){
    float lookupvaluef;
    short lookupvalue;
    float temperature = -300;
    lookupvaluef = ((5 / voltage)*(adcvalue - 0.2)) * 400;
    lookupvalue = (short)lookupvaluef;
    std::map<short, short >::iterator mi = ntcmap.find(lookupvalue);
    while ((mi == ntcmap.end()) & (lookupvalue < 1181)) {
        lookupvalue++;
        mi = ntcmap.find(lookupvalue);
    }
    if (mi == ntcmap.end()) {
        temperature = (--mi)->second; // Always show maximum temperature when at end of lookupmap
    }
    else {
        temperature = mi->second;
    }
    return (float)temperature / 100;
}


ntc::ntc(){

    //initialize ntc lookup map
    ntcmap[2] = -4000;
    ntcmap[3] = -3975;
    ntcmap[4] = -3950;
    ntcmap[6] = -3925;
    ntcmap[7] = -3900;
    ntcmap[8] = -3875;
    ntcmap[10] = -3850;
    ntcmap[11] = -3825;
    ntcmap[12] = -3800;
    ntcmap[14] = -3775;
    ntcmap[15] = -3750;
    ntcmap[16] = -3725;
    ntcmap[18] = -3700;
    ntcmap[19] = -3675;
    ntcmap[21] = -3650;
    ntcmap[22] = -3625;
    ntcmap[23] = -3600;
    ntcmap[25] = -3575;
    ntcmap[26] = -3550;
    ntcmap[27] = -3525;
    ntcmap[29] = -3500;
    ntcmap[30] = -3475;
    ntcmap[32] = -3450;
    ntcmap[34] = -3425;
    ntcmap[35] = -3400;
    ntcmap[37] = -3375;
    ntcmap[39] = -3350;
    ntcmap[40] = -3325;
    ntcmap[42] = -3300;
    ntcmap[44] = -3275;
    ntcmap[45] = -3250;
    ntcmap[47] = -3225;
    ntcmap[49] = -3200;
    ntcmap[50] = -3175;
    ntcmap[52] = -3150;
    ntcmap[54] = -3125;
    ntcmap[55] = -3100;
    ntcmap[57] = -3075;
    ntcmap[59] = -3050;
    ntcmap[60] = -3025;
    ntcmap[62] = -3000;
    ntcmap[64] = -2975;
    ntcmap[66] = -2950;
    ntcmap[68] = -2925;
    ntcmap[70] = -2900;
    ntcmap[72] = -2875;
    ntcmap[75] = -2850;
    ntcmap[77] = -2825;
    ntcmap[79] = -2800;
    ntcmap[81] = -2775;
    ntcmap[83] = -2750;
    ntcmap[85] = -2725;
    ntcmap[87] = -2700;
    ntcmap[89] = -2675;
    ntcmap[91] = -2650;
    ntcmap[93] = -2625;
    ntcmap[95] = -2600;
    ntcmap[97] = -2575;
    ntcmap[99] = -2550;
    ntcmap[101] = -2525;
    ntcmap[103] = -2500;
    ntcmap[106] = -2475;
    ntcmap[108] = -2450;
    ntcmap[111] = -2425;
    ntcmap[113] = -2400;
    ntcmap[116] = -2375;
    ntcmap[118] = -2350;
    ntcmap[121] = -2325;
    ntcmap[123] = -2300;
    ntcmap[126] = -2275;
    ntcmap[128] = -2250;
    ntcmap[131] = -2225;
    ntcmap[133] = -2200;
    ntcmap[136] = -2175;
    ntcmap[138] = -2150;
    ntcmap[141] = -2125;
    ntcmap[143] = -2100;
    ntcmap[145] = -2075;
    ntcmap[148] = -2050;
    ntcmap[150] = -2025;
    ntcmap[153] = -2000;
    ntcmap[156] = -1975;
    ntcmap[159] = -1950;
    ntcmap[162] = -1925;
    ntcmap[165] = -1900;
    ntcmap[167] = -1875;
    ntcmap[170] = -1850;
    ntcmap[173] = -1825;
    ntcmap[176] = -1800;
    ntcmap[179] = -1775;
    ntcmap[182] = -1750;
    ntcmap[185] = -1725;
    ntcmap[188] = -1700;
    ntcmap[191] = -1675;
    ntcmap[194] = -1650;
    ntcmap[197] = -1625;
    ntcmap[200] = -1600;
    ntcmap[203] = -1575;
    ntcmap[205] = -1550;
    ntcmap[208] = -1525;
    ntcmap[211] = -1500;
    ntcmap[215] = -1475;
    ntcmap[218] = -1450;
    ntcmap[221] = -1425;
    ntcmap[225] = -1400;
    ntcmap[228] = -1375;
    ntcmap[231] = -1350;
    ntcmap[235] = -1325;
    ntcmap[238] = -1300;
    ntcmap[242] = -1275;
    ntcmap[245] = -1250;
    ntcmap[248] = -1225;
    ntcmap[252] = -1200;
    ntcmap[255] = -1175;
    ntcmap[258] = -1150;
    ntcmap[262] = -1125;
    ntcmap[265] = -1100;
    ntcmap[269] = -1075;
    ntcmap[272] = -1050;
    ntcmap[275] = -1025;
    ntcmap[279] = -1000;
    ntcmap[282] = -975;
    ntcmap[286] = -950;
    ntcmap[290] = -925;
    ntcmap[294] = -900;
    ntcmap[298] = -875;
    ntcmap[301] = -850;
    ntcmap[305] = -825;
    ntcmap[309] = -800;
    ntcmap[313] = -775;
    ntcmap[317] = -750;
    ntcmap[320] = -725;
    ntcmap[324] = -700;
    ntcmap[328] = -675;
    ntcmap[332] = -650;
    ntcmap[336] = -625;
    ntcmap[339] = -600;
    ntcmap[343] = -575;
    ntcmap[347] = -550;
    ntcmap[351] = -525;
    ntcmap[355] = -500;
    ntcmap[359] = -475;
    ntcmap[363] = -450;
    ntcmap[367] = -425;
    ntcmap[371] = -400;
    ntcmap[376] = -375;
    ntcmap[380] = -350;
    ntcmap[384] = -325;
    ntcmap[388] = -300;
    ntcmap[392] = -275;
    ntcmap[397] = -250;
    ntcmap[401] = -225;
    ntcmap[405] = -200;
    ntcmap[409] = -175;
    ntcmap[413] = -150;
    ntcmap[418] = -125;
    ntcmap[422] = -100;
    ntcmap[426] = -75;
    ntcmap[430] = -50;
    ntcmap[434] = -25;
    ntcmap[439] = 0;
    ntcmap[443] = 25;
    ntcmap[448] = 50;
    ntcmap[452] = 75;
    ntcmap[457] = 100;
    ntcmap[461] = 125;
    ntcmap[466] = 150;
    ntcmap[470] = 175;
    ntcmap[475] = 200;
    ntcmap[479] = 225;
    ntcmap[484] = 250;
    ntcmap[488] = 275;
    ntcmap[493] = 300;
    ntcmap[497] = 325;
    ntcmap[502] = 350;
    ntcmap[506] = 375;
    ntcmap[511] = 400;
    ntcmap[515] = 425;
    ntcmap[520] = 450;
    ntcmap[524] = 475;
    ntcmap[529] = 500;
    ntcmap[534] = 525;
    ntcmap[538] = 550;
    ntcmap[543] = 575;
    ntcmap[548] = 600;
    ntcmap[553] = 625;
    ntcmap[558] = 650;
    ntcmap[562] = 675;
    ntcmap[567] = 700;
    ntcmap[572] = 725;
    ntcmap[577] = 750;
    ntcmap[581] = 775;
    ntcmap[586] = 800;
    ntcmap[591] = 825;
    ntcmap[596] = 850;
    ntcmap[600] = 875;
    ntcmap[605] = 900;
    ntcmap[610] = 925;
    ntcmap[615] = 950;
    ntcmap[620] = 975;
    ntcmap[624] = 1000;
    ntcmap[629] = 1025;
    ntcmap[634] = 1050;
    ntcmap[639] = 1075;
    ntcmap[644] = 1100;
    ntcmap[649] = 1125;
    ntcmap[654] = 1150;
    ntcmap[659] = 1175;
    ntcmap[664] = 1200;
    ntcmap[669] = 1225;
    ntcmap[673] = 1250;
    ntcmap[678] = 1275;
    ntcmap[683] = 1300;
    ntcmap[688] = 1325;
    ntcmap[693] = 1350;
    ntcmap[698] = 1375;
    ntcmap[703] = 1400;
    ntcmap[708] = 1425;
    ntcmap[713] = 1450;
    ntcmap[718] = 1475;
    ntcmap[723] = 1500;
    ntcmap[727] = 1525;
    ntcmap[732] = 1550;
    ntcmap[737] = 1575;
    ntcmap[742] = 1600;
    ntcmap[747] = 1625;
    ntcmap[752] = 1650;
    ntcmap[757] = 1675;
    ntcmap[762] = 1700;
    ntcmap[767] = 1725;
    ntcmap[772] = 1750;
    ntcmap[777] = 1775;
    ntcmap[782] = 1800;
    ntcmap[787] = 1825;
    ntcmap[792] = 1850;
    ntcmap[797] = 1875;
    ntcmap[802] = 1900;
    ntcmap[807] = 1925;
    ntcmap[812] = 1950;
    ntcmap[817] = 1975;
    ntcmap[822] = 2000;
    ntcmap[827] = 2025;
    ntcmap[831] = 2050;
    ntcmap[836] = 2075;
    ntcmap[841] = 2100;
    ntcmap[846] = 2125;
    ntcmap[851] = 2150;
    ntcmap[856] = 2175;
    ntcmap[861] = 2200;
    ntcmap[866] = 2225;
    ntcmap[871] = 2250;
    ntcmap[875] = 2275;
    ntcmap[880] = 2300;
    ntcmap[885] = 2325;
    ntcmap[890] = 2350;
    ntcmap[895] = 2375;
    ntcmap[900] = 2400;
    ntcmap[905] = 2425;
    ntcmap[910] = 2450;
    ntcmap[915] = 2475;
    ntcmap[920] = 2500;
    ntcmap[924] = 2525;
    ntcmap[929] = 2550;
    ntcmap[933] = 2575;
    ntcmap[938] = 2600;
    ntcmap[942] = 2625;
    ntcmap[947] = 2650;
    ntcmap[952] = 2675;
    ntcmap[956] = 2700;
    ntcmap[961] = 2725;
    ntcmap[965] = 2750;
    ntcmap[970] = 2775;
    ntcmap[975] = 2800;
    ntcmap[979] = 2825;
    ntcmap[984] = 2850;
    ntcmap[988] = 2875;
    ntcmap[993] = 2900;
    ntcmap[998] = 2925;
    ntcmap[1002] = 2950;
    ntcmap[1007] = 2975;
    ntcmap[1011] = 3000;
    ntcmap[1016] = 3025;
    ntcmap[1020] = 3050;
    ntcmap[1025] = 3075;
    ntcmap[1029] = 3100;
    ntcmap[1034] = 3125;
    ntcmap[1038] = 3150;
    ntcmap[1042] = 3175;
    ntcmap[1047] = 3200;
    ntcmap[1051] = 3225;
    ntcmap[1056] = 3250;
    ntcmap[1060] = 3275;
    ntcmap[1065] = 3300;
    ntcmap[1069] = 3325;
    ntcmap[1074] = 3350;
    ntcmap[1078] = 3375;
    ntcmap[1082] = 3400;
    ntcmap[1087] = 3425;
    ntcmap[1091] = 3450;
    ntcmap[1096] = 3475;
    ntcmap[1100] = 3500;
    ntcmap[1104] = 3525;
    ntcmap[1108] = 3550;
    ntcmap[1113] = 3575;
    ntcmap[1117] = 3600;
    ntcmap[1121] = 3625;
    ntcmap[1125] = 3650;
    ntcmap[1130] = 3675;
    ntcmap[1134] = 3700;
    ntcmap[1138] = 3725;
    ntcmap[1142] = 3750;
    ntcmap[1146] = 3775;
    ntcmap[1151] = 3800;
    ntcmap[1155] = 3825;
    ntcmap[1159] = 3850;
    ntcmap[1163] = 3875;
    ntcmap[1167] = 3900;
    ntcmap[1172] = 3925;
    ntcmap[1176] = 3950;
    ntcmap[1180] = 3975;

};



